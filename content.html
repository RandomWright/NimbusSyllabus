<!DOCTYPE html>
<html>
	<head>
		<title>Nimbus Syllabus</title>
		<link rel="stylesheet" type="text/css" href="http://nimsyllabus.com/style.css">
		<link rel="shortcut icon" type="image/png" href="http://nimsyllabus.com/favicon.png">
		<link rel="icon" type="image/png" href="http://nimsyllabus.com/favicon.png">

		<script src="http://nimsyllabus.com/jquery-3.1.1.min.js"></script>
		<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
		
		
		<script>		
		function myFunction() {
			document.getElementById('group_form').style.display = "block";		
		}
		</script>
		
		<script>
		$(document).ready(function(){
			$('.group_form').bind('submit', function(e) {
				$('.message').remove();

		        e.preventDefault();
				var data = $(this).serialize();
				data += "&submit=%2B%20New%20Group";

		        $.ajax({
		        	url: "http://nimsyllabus.com/cgi-bin/nimbus-accounts.py", 
		        	type: "GET",
		        	data: data,
		        	success: function(result){
		        		/*$('html').html(result);*/

						var groupHeader = $('.group_header');
						groupHeader.animate({height: 0, "margin" : 0}, function() {
							groupHeader.remove();
						});

		        		var resultDiv = $(result).insertAfter('.footer');
		        		$(resultDiv).append('<div class="group_buttons"><button class="group_edit">E</button><button class="group_delete">X</button></div><div class="group_content">No files yet :)</div>');
		       		}
		        });
		    });

		    $('.group').each(function(i, obj) {
		    	$(obj).append('<div class="group_buttons"><button class="group_hide">HIDE</button><button class="group_edit">E</button><button class="group_delete">X</button></div><div class="group_content">No files yet :)</div>');
			});
			
			$('body').on('click', '.group_delete', function(){
				/*var buttonClass = $(this).attr('class');
				if(buttonClass == 'group_delete'){
		        	var groupHeader = $('.group_header');
		        	groupHeader.append('equal');
				}*/

			    var groupDiv = $(this).parent().parent(); /* first parent is button tray (group_buttons) */
			    var groupId = groupDiv.attr("id"); /*$(this).attr("id");*/
			    var groupData = {"submit" : "Delete",
			    				 "id" : groupId};

				$.ajax({
		        	url: "http://nimsyllabus.com/cgi-bin/nimbus-accounts.py",
		        	type: "GET",
		        	data: groupData,
		        }).always(function(data, textStatus, jqXHR){
		        	var trimmedResultString = $.trim(data);
		        	if(trimmedResultString == 'Success'){
		        		var groupHeader = $('.group_header');
		        		groupHeader.animate({height: 0, "margin" : 0}, function() {
				        	groupHeader.remove();
			        	});

		        		groupDiv.animate({height: 0, "padding-top" : 0, "padding-bottom" : 0}, function() {
				        	groupDiv.remove();
		        		});
		        	}
		        	else{
				    	groupDiv.append('Failed to delete: "' + trimmedResultString + '" inside of ' + groupDiv);
		        	}
	       		});			
			});

			$('body').on('click', '.group_hide', function(){
				var groupHideButton = $(this);
			    var groupDiv = groupHideButton.parent().parent(); /* first parent is button tray (group_buttons) */
			    var groupContentDiv = groupDiv.find('.group_content');

  				groupContentDiv.slideUp("slow", function() {
    				groupHideButton.replaceWith('<button class="group_show" style="margin-right: 10px;">SHOW</button>');
		        });
			});

			$('body').on('click', '.group_show', function(){
				var groupShowButton = $(this);
			    var groupDiv = groupShowButton.parent().parent();
			    var groupContentDiv = groupDiv.find('.group_content');

  				groupContentDiv.slideDown("slow", function() {
    				groupShowButton.replaceWith('<button class="group_hide">HIDE</button>');
		        });
			});
		});
		
		</script>
	</head>

	<body>
		
		<div class="header">
			<a href="http://nimsyllabus.com"><img src="http://nimsyllabus.com/favicon.png" />
			<h1>Nimbus Syllabus</h1></a>			
		</div>

		<div class="footer">
			<div class="logout"><a style="color: #57a4ed;" href="http://nimsyllabus.com/cgi-bin/nimbus-accounts.py?submit=Logout">Log out</a></div>

			
			<form class="group_form" action="">
				<input type="name" placeholder="new group name" name="group_name"/>
				<input type="color" placeholder="color" name="group_color"/><br/>
				<input type="submit" name="submit" value="+ New Group"/><br/>
			</form>
		</div>				
		
		<script language="javascript">
			(function() {
				loginIfPossible();

	            function lookCookie(name){
	                var cookiepart = name + "=";
	         	    var ca = document.cookie.split(';');
	        	    for (var i = 0; i < ca.length; i++) {
	                	var c = ca[i];
						while (c.charAt(0) == ' ') {
	                   		c = c.substring(1);
	                	}
	                	
	                	if (c.indexOf(cookiepart) == 0) {
	                		//if the cookie is found return cookie
	                    	return c.substring(cookiepart.length, c.length);
	                	}
	                	
	                	return "";
	                }
				}

				function loginIfPossible() {
		           	var username = lookCookie('account_cookie');

		            if (!username || username.length == 0) {
		                document.location.href = 'http://nimsyllabus.com/index.html';
		            }

		            else {
		            	var lazy_load_url = 'http://nimsyllabus.com/cgi-bin/nimbus-accounts.py?submit=Cookie+Login&username=' + username;

		            	if (document.location.href != lazy_load_url) {
			                document.location.href = 'http://nimsyllabus.com/cgi-bin/nimbus-accounts.py?submit=Cookie+Login&username=' + username;
		            	}

		            	else {
		            		var logoutDiv = document.getElementsByClassName('logout');
							logoutDiv[0].innerHTML = '<div class="username">' + username + "</div>" + logoutDiv[0].innerHTML;
		            	}
		            }
				}
           	})();
        </script>
	</body>
</html>