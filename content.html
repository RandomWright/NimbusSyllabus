<!DOCTYPE html>
<html>
	<head>
		<title>Nimbus Syllabus</title>
		<link rel="stylesheet" type="text/css" href="http://nimsyllabus.com/style.css">
		<link rel="shortcut icon" type="image/png" href="http://nimsyllabus.com/favicon.png">
		<link rel="icon" type="image/png" href="http://nimsyllabus.com/favicon.png">

		<script src="http://nimsyllabus.com/jquery-3.1.1.min.js"></script>
		<script>
		$(document).ready(function(){
			$('.group_form').bind('submit', function() {
				var data = $(this).serializeArray();

		        $.ajax({
		        	url: "http://nimsyllabus.com/cgi-bin/nimbus-accounts.py", 
		        	type: "GET",
		        	data: data,
		        	success: function(result){
		        		$('html').html(result);
		       		}
		        });
		    });

		    $('.group').each(function(i, obj) {
		    	$(obj).append('<button class="group_delete">X</button>');
			});

			$('.group_delete').click(function() {
			    var groupDiv = $(this).parent();
			    var groupId = groupDiv.attr("id"); /*$(this).attr("id");*/
			    var groupData = {"submit" : "Delete",
			    				 "id" : groupId};

				$.ajax({
		        	url: "http://nimsyllabus.com/cgi-bin/nimbus-accounts.py",
		        	type: "GET",
		        	data: groupData,
		        }).always(function(data, textStatus, jqXHR){
		        	var trimmedResultString = $.trim(data);
		        	if(trimmedResultString == 'Success'){
		        		groupDiv.animate({height: 0, "padding-top" : 0, "padding-bottom" : 0}, function() {
				        	groupDiv.remove();
		        		});
		        	}
		        	else{
				    	groupDiv.append('Failed to delete: "' + trimmedResultString + '"');
		        	}
	       		});
	       		/*.fail(function(jqXHR, textStatus, error){
			    	groupDiv.append('Failed to delete' + error)
		        });*/
			});

		});
		</script>

		<script language="javascript">
			window.onload = loginIfPossible()

            function lookCookie(name){
                var cookiepart = name + "=";
         	    var ca = document.cookie.split(';');
        	    for (var i = 0; i < ca.length; i++) {
                	var c = ca[i];
					while (c.charAt(0) == ' ') {
                   		c = c.substring(1);
                	}
                	
                	if (c.indexOf(cookiepart) == 0) {
                		//if the cookie is found return cookie
                    	return c.substring(cookiepart.length, c.length);
                	}
                	
                	return "";
                }
			}

			function loginIfPossible() {
	           	var username = lookCookie('account_cookie');

	            if (!username || username.length == 0) {
	                document.location.href = 'http://nimsyllabus.com/index.html';
	            }

	            else {
	            	var lazy_load_url = 'http://nimsyllabus.com/cgi-bin/nimbus-accounts.py?submit=Cookie+Login&username=' + username;

	            	if (document.location.href != lazy_load_url) {
		                document.location.href = 'http://nimsyllabus.com/cgi-bin/nimbus-accounts.py?submit=Cookie+Login&username=' + username;
	            	}
	            }
			}
           	
        </script>

	</head>

	<body>

		<div class="header">
			<a href="http://nimsyllabus.com"><img src="http://nimsyllabus.com/favicon.png" />
			<h1>Nimbus Syllabus</h1></a>
		</div>

		<div class="footer">
			<div class="logout"><a style="color: #57a4ed;" href="http://nimsyllabus.com/cgi-bin/nimbus-accounts.py?submit=Logout">Log out</a></div>

			<form class="group_form">
				<input type="name" placeholder="new group name" name="group_name"/>
				<input type="color" placeholder="color" name="group_color"/><br/>
				<input type="submit" name="submit" value="+ New Group"/><br/>
			</form>
		</div>

	</body>
</html>